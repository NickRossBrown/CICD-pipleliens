image: docker:latest
 
# When using dind, it's wise to use the overlayfs driver for
# improved performance.
variables:
  DOCKER_DRIVER: overlay2

services:
- docker:dind

before_script:
- docker info

stages:
  - build_base

build_tests:
  stage: build_base
  script:
  - docker build -t myimage/gitlab -f Dockerfile.dev .
  - docker run myimage/gitlab npm run test -- --coverage

